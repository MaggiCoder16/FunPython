name: botli ki specific files ko sync karle gavar

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */2 * * *"

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout our repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.PAT_TOKEN }}

      - name: Configure Git identity
        run: |
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"

      - name: Add BotLi remote
        run: |
          git remote add botli https://github.com/Torom/BotLi.git || echo "botli sala remote already exists"
          git fetch botli main

      - name: Sync Python files with patch (excluding chatter.py)
        run: |
          exclude_files="chatter.py"
          py_files=$(git ls-tree -r --name-only botli/main | grep '\.py$' | grep -Ev "$exclude_files")

          for f in $py_files; do
            echo "Syncing $f with patch..."
            git diff botli/main -- "$f" > update.patch
            if [ -s update.patch ]; then
              git apply update.patch
              echo "Applied updates to $f"
            else
              echo "No updates for $f"
            fi
            rm -f update.patch
          done

          git add .
          git commit -m "Sync BotLi Python files (patch applied, chatter.py excluded)" || echo "No changes to commit gadhe"

      - name: Push changes
        run: git push origin main
